# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram-–±–æ—Ç–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞–≤–∏–∞–∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤

## 1) –¶–µ–ª–∏ –∏ –æ–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ [aviation-safety.net](https://aviation-safety.net/).
- –û–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–æ–≤—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã (–±–µ–∑ –¥—É–±–ª–µ–π).
- –§–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—É–±–ª–∏–∫–∞—Ü–∏—é –¥–ª—è Telegram-–∫–∞–Ω–∞–ª–∞ `@avia_crash` –ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É —Ä–µ–¥–∞–∫—Ü–∏–æ–Ω–Ω–æ–º—É —à–∞–±–ª–æ–Ω—É.
- –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ DeepSeek –¥–ª—è —Ä–µ—Ä–∞–π—Ç–∞ –≤ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–º –∂—É—Ä–Ω–∞–ª–∏—Å—Ç—Å–∫–æ–º —Å—Ç–∏–ª–µ.
- –ü—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ø–æ—Å—Ç –≤ Telegram –∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

## 2) –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è
- **Collector (–ø–∞—Ä—Å–µ—Ä –∏—Å—Ç–æ—á–Ω–∏–∫–∞):** –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–æ–±—ã—Ç–∏–π —Å aviation-safety.net.
- **Normalizer:** –ø—Ä–∏–≤–æ–¥–∏—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∫ –µ–¥–∏–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É (–¥–∞—Ç–∞, –º–µ—Å—Ç–æ, –í–°, –æ–ø–µ—Ä–∞—Ç–æ—Ä, —Å—Ç–∞—Ç—É—Å, –∏—Å—Ç–æ—á–Ω–∏–∫).
- **Deduplicator/Storage:** —Ö—Ä–∞–Ω–∏—Ç –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —É–∂–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (SQLite/PostgreSQL).
- **AI Rewriter (DeepSeek):** –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–æ—Å—Ç–∞ –ø–æ —Å—Ç—Ä–æ–≥–æ–º—É –ø—Ä–æ–º–ø—Ç—É –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- **Publisher (Telegram Bot API):** –ø—É–±–ª–∏–∫—É–µ—Ç –≤ `@avia_crash`.
- **Scheduler/Worker:** –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ N –º–∏–Ω—É—Ç.
- **Observability:** –ª–æ–≥–∏, –º–µ—Ç—Ä–∏–∫–∏, –∞–ª–µ—Ä—Ç—ã.

## 3) –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è)
- **–Ø–∑—ã–∫:** Python 3.11+
- **HTTP:** `httpx`
- **–ü–∞—Ä—Å–∏–Ω–≥ HTML:** `BeautifulSoup4` + `lxml`
- **–ë–î:** SQLite (—Å—Ç–∞—Ä—Ç) / PostgreSQL (–ø—Ä–æ–¥)
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫:** APScheduler –∏–ª–∏ Celery Beat
- **Telegram:** `aiogram` –∏–ª–∏ –ø—Ä—è–º–æ–π Telegram Bot API
- **LLM API:** DeepSeek Chat/Reasoner —á–µ—Ä–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π HTTP API
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è:** Docker + docker-compose

## 4) –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö (end-to-end)
1. Scheduler –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É `check_new_incidents`.
2. Collector –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É/–ª–µ–Ω—Ç—ã –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∫–∞—Ä—Ç–æ—á–∫–∏ —Å–æ–±—ã—Ç–∏–π.
3. Normalizer —Å—Ç—Ä–æ–∏—Ç `incident_id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, hash –æ—Ç date+aircraft+location+source_url).
4. Deduplicator —Å–≤–µ—Ä—è–µ—Ç `incident_id` —Å –ë–î.
5. –î–ª—è –Ω–æ–≤—ã—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤:
   - —Å–æ–±–∏—Ä–∞—Ç—å —Ñ–∞–∫—Ç—ã –∏–∑ –ø–µ—Ä–≤–æ–∏—Å—Ç–æ—á–Ω–∏–∫–∞;
   - —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å `structured_fact_sheet`;
   - –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤ DeepSeek —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º –ø—Ä–æ–º–ø—Ç–æ–º –∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏;
   - –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –ø–æ —á–µ–∫-–ª–∏—Å—Ç—É.
6. Publisher –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ Telegram-–∫–∞–Ω–∞–ª.
7. –í –ë–î —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, —Ç–µ–∫—Å—Ç –∏ timestamp.
8. –û—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–ª—É–∂–µ–±–Ω—ã–π —á–∞—Ç/–ª–æ–≥.

## 5) –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```text
avia_bot/
  app/
    main.py
    config.py
    scheduler.py
    collector/
      aviation_safety.py
    domain/
      models.py
      normalizer.py
      dedupe.py
    ai/
      deepseek_client.py
      prompt_templates.py
      validator.py
    publisher/
      telegram_client.py
    storage/
      db.py
      repository.py
    observability/
      logging.py
      metrics.py
  tests/
  .env.example
  Dockerfile
  docker-compose.yml
```

## 6) –ü—Ä–æ–º–ø—Ç–∏–Ω–≥ –∏ –ø—Ä–∞–≤–∏–ª–∞ —Ä–µ—Ä–∞–π—Ç–∞ (DeepSeek)
### 6.1 System prompt (—è–¥—Ä–æ)
- –†–æ–ª—å: –æ–ø—ã—Ç–Ω—ã–π –∞–≤–∏–∞—Ü–∏–æ–Ω–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä-–∫–æ–ø–∏—Ä–∞–π—Ç–µ—Ä.
- –°—Ç–∏–ª—å: –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π, –±–µ–∑ —Å–µ–Ω—Å–∞—Ü–∏–æ–Ω–Ω–æ—Å—Ç–∏.
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ: —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —Ñ–∞–∫—Ç—ã –∏–∑ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
- –ó–∞–ø—Ä–µ—Ç: –Ω–µ –¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥–æ–≤ –æ –ø—Ä–∏—á–∏–Ω–∞—Ö –±–µ–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

### 6.2 User prompt (—à–∞–±–ª–æ–Ω)
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–∫—Ç–æ–≤: `what/when/where/who/details/injuries/official_statements/investigation/source_links`.
- –¢—Ä–µ–±–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç Telegram:
  - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–æ 60 —Å–∏–º–≤–æ–ª–æ–≤;
  - 3 –∞–±–∑–∞—Ü–∞;
  - —ç–º–æ–¥–∑–∏ ‚úàÔ∏èüö®‚ö†Ô∏è;
  - —Ö–µ—à—Ç–µ–≥–∏: `#–∞–≤–∏–∞—Ü–∏—è #–ø—Ä–æ–∏—Å—à–µ—Å—Ç–≤–∏–µ #[—Ä–µ–≥–∏–æ–Ω]` + —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ.
- –î–ª–∏–Ω–∞: 150‚Äì300 —Å–ª–æ–≤.

### 6.3 –ü–æ—Å—Ç-–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏–∫–∞—Ü–∏–µ–π
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª–∏–Ω—ã —Ç–µ–∫—Å—Ç–∞.
- –ù–∞–ª–∏—á–∏–µ –±–ª–æ–∫–æ–≤: –∑–∞–≥–æ–ª–æ–≤–æ–∫, –ª–∏–¥, –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏, –ø–æ—Å—Ç—Ä–∞–¥–∞–≤—à–∏–µ/—Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ.
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–ø–µ–∫—É–ª—è—Ü–∏–π (—ç–≤—Ä–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ç–æ–ø-—Å–ª–æ–≤–∞–º –∏ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞–º).
- –ù–∞–ª–∏—á–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫(–∏).
- –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—à–ª–∞ ‚Äî fallback: —à–∞–±–ª–æ–Ω–Ω–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è –±–µ–∑ AI.

## 7) –ê–Ω—Ç–∏–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å
- –•—Ä–∞–Ω–∏—Ç—å `source_url`, `incident_id`, `first_seen_at`, `published_at`.
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–Ω–¥–µ–∫—Å –ø–æ `incident_id`.
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –¥–ª—è `status=failed` —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º retry.

## 8) –ü—É–±–ª–∏–∫–∞—Ü–∏—è –≤ Telegram
- –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–∞ `@avia_crash` —Å –ø—Ä–∞–≤–æ–º –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `sendMessage` —Å `parse_mode=Markdown` –∏–ª–∏ `HTML`.
- –õ–∏–º–∏—Ç –¥–ª–∏–Ω—ã Telegram —É—á–∏—Ç—ã–≤–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ.
- –ü—Ä–∏ –æ—à–∏–±–∫–µ API: –ª–æ–≥ + retry —Å backoff.

## 9) –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Å–µ–∫—Ä–µ—Ç—ã
–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
- `TELEGRAM_BOT_TOKEN`
- `TELEGRAM_CHANNEL=@avia_crash`
- `DEEPSEEK_API_KEY`
- `DEEPSEEK_MODEL`
- `POLL_INTERVAL_MINUTES=10`
- `DATABASE_URL`
- `LOG_LEVEL`

–°–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–ª—å–∫–æ –≤ `.env`/vault, –Ω–µ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

## 10) –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –∞–ª–µ—Ä—Ç—ã
- –°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ JSON-–ª–æ–≥–∏ –ø–æ –∫–∞–∂–¥–æ–º—É —à–∞–≥—É.
- –ú–µ—Ç—Ä–∏–∫–∏: `incidents_found`, `incidents_published`, `publish_failures`, `rewrite_failures`.
- –ê–ª–µ—Ä—Ç –≤ —Å–ª—É–∂–µ–±–Ω—ã–π Telegram-—á–∞—Ç –ø—Ä–∏ —Å–µ—Ä–∏–∏ –æ—à–∏–±–æ–∫.

## 11) –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∏ —ç—Ç–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–ø—É—Å—Ç–∏–º–æ—Å—Ç—å –ø–∞—Ä—Å–∏–Ω–≥–∞ aviation-safety.net (robots.txt, ToS, —á–∞—Å—Ç–æ—Ç–∞ –∑–∞–ø—Ä–æ—Å–æ–≤).
- –£–∫–∞–∑—ã–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫ –≤ –∫–∞–∂–¥–æ–º –ø–æ—Å—Ç–µ.
- –°—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –æ–± –æ—Å–≤–µ—â–µ–Ω–∏–∏ –∂–µ—Ä—Ç–≤ –∏ –Ω–µ–ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

## 12) –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —ç—Ç–∞–ø–∞–º
### –≠—Ç–∞–ø 1. MVP (1‚Äì2 –¥–Ω—è)
- –ü–∞—Ä—Å–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤.
- SQLite + –¥–µ–¥—É–ø.
- –ü—Ä–æ—Å—Ç–∞—è Telegram-–ø—É–±–ª–∏–∫–∞—Ü–∏—è –±–µ–∑ AI.

### –≠—Ç–∞–ø 2. AI-—Ä–µ—Ä–∞–π—Ç (1 –¥–µ–Ω—å)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è DeepSeek.
- –ü—Ä–æ–º–ø—Ç + –≤–∞–ª–∏–¥–∞—Ü–∏—è + fallback.

### –≠—Ç–∞–ø 3. –ü—Ä–æ–º—ã—à–ª–µ–Ω–Ω–∞—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è (1‚Äì2 –¥–Ω—è)
- Docker, healthchecks, —Ä–µ—Ç—Ä–∞–∏, –∞–ª–µ—Ä—Ç—ã, –º–µ—Ç—Ä–∏–∫–∏.
- –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã.

## 13) –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- Unit: normalizer, dedupe, validator.
- Integration: –ø–∞—Ä—Å–∏–Ω–≥ —Ä–µ–∞–ª—å–Ω–æ–π HTML-—Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–ø–∏—è).
- E2E: –Ω–æ–≤—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç -> DeepSeek -> Telegram mock.
- Dry-run —Ä–µ–∂–∏–º: —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å—Ç—ã –±–µ–∑ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

## 14) Definition of Done
- –ù–æ–≤—ã–µ –∑–∞–ø–∏—Å–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ –¥–µ—Ç–µ–∫—Ç–∏—Ä—É—é—Ç—Å—è.
- –î—É–±–ª–∏ –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è.
- –ü–æ—Å—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —à–∞–±–ª–æ–Ω—É –∏ —á–µ–∫-–ª–∏—Å—Ç—É.
- –û—à–∏–±–∫–∏ –Ω–∞–±–ª—é–¥–∞–µ–º—ã, –µ—Å—Ç—å –∞–≤—Ç–æ–ø–æ–≤—Ç–æ—Ä—ã.
- –ö–∞–Ω–∞–ª `@avia_crash` –ø–æ–ª—É—á–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.

## 15) –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç –≤–∞—Å –¥–ª—è —Å—Ç–∞—Ä—Ç–∞
1. `TELEGRAM_BOT_TOKEN` –∏ –¥–æ—Å—Ç—É–ø –±–æ—Ç–∞ –≤ –∫–∞–Ω–∞–ª `@avia_crash`.
2. API-–∫–ª—é—á DeepSeek.
3. –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5/10/15 –º–∏–Ω—É—Ç).
4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–∫–∞–∫–∞—è –∏–º–µ–Ω–Ω–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ASN –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ).
